<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Word to PDF Converter</title>
      <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.1/dist/tailwind.min.css" rel="stylesheet">
      <link rel="icon" href="assets/favicon.svg" type="image/png">
      <style>
         nav li:hover > ul {
            display: block;
         }
         nav ul li a {
            display: block;
            clear: both;
         }
         nav ul ul {
            position: absolute;
            left: 0;
            top: 100%;
            min-width: 200px;
            z-index: 1000;
         }
         footer {
            background-color: #f5f5fa;
            color: #1a202c;
         }
         footer a {
            color: inherit;
         }
         footer a:hover {
            color: #4a5568;
         }
      </style>
   </head>
   <body class="bg-faf6f6 min-h-screen flex flex-col items-center">
      <header class="w-full bg-white py-3 shadow-md flex items-center justify-between" style="height: 70px;">
         <div class="flex items-center">
            <a href="/" class="flex items-center">
               <img src="assets/favicon.svg" alt="Logo" style="height: 30px;">
               <span class="text-xl font-bold text-gray-800 ml-2">WordToPDF</span>
            </a>
         </div>
         <nav>
            <ul class="flex space-x-4 mr-4">
               <li><a href="merge-pdf" class="nav-link text-gray-800 hover:text-red-500">MERGE PDF</a></li>
               <li><a href="split-pdf" class="nav-link text-gray-800 hover:text-red-500">SPLIT PDF</a></li>
               <li><a href="compress-pdf" class="nav-link text-gray-800 hover:text-red-500">COMPRESS PDF</a></li>
               <li class="relative">
                  <a href="#" class="nav-link text-gray-800 hover:text-red-500 flex items-center">
                     CONVERT PDF 
                     <svg class="fill-current text-gray-800 ml-1 w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M5.95 6.95l4 4 4-4 .9.9-4.9 4.9-4.9-4.9.9-.9z"/>
                     </svg>
                  </a>
                  <ul class="dropdown-menu absolute hidden bg-white shadow-lg mt-1">
                     <li class="px-4 py-2 text-gray-500 text-sm">CONVERT TO PDF</li>
                     <li><a href="jpg-to-pdf" class="block px-4 py-2 text-gray-800 hover:text-red-500">JPG to PDF</a></li>
                     <li><a href="word-to-pdf" class="block px-4 py-2 text-gray-800 hover:text-red-500">WORD to PDF</a></li>
                     <li><a href="powerpoint-to-pdf" class="block px-4 py-2 text-gray-800 hover:text-red-500">POWERPOINT to PDF</a></li>
                     <li><a href="excel-to-pdf" class="block px-4 py-2 text-gray-800 hover:text-red-500">EXCEL to PDF</a></li>
                     <li><a href="html-to-pdf" class="block px-4 py-2 text-gray-800 hover:text-red-500">HTML to PDF</a></li>
                     <li class="px-4 py-2 text-gray-500 text-sm">CONVERT FROM PDF</li>
                     <li><a href="pdf-to-jpg" class="block px-4 py-2 text-gray-800 hover:text-red-500">PDF to JPG</a></li>
                     <li><a href="pdf-to-word" class="block px-4 py-2 text-gray-800 hover:text-red-500">PDF to WORD</a></li>
                     <li><a href="pdf-to-powerpoint" class="block px-4 py-2 text-gray-800 hover:text-red-500">PDF to POWERPOINT</a></li>
                     <li><a href="pdf-to-excel" class="block px-4 py-2 text-gray-800 hover:text-red-500">PDF to EXCEL</a></li>
                     <li><a href="pdf-to-pdfa" class="block px-4 py-2 text-gray-800 hover:text-red-500">PDF to PDF/A</a></li>
                  </ul>
               </li>
            </ul>
         </nav>
      </header>
      <div class="mt-5 w-full max-w-md px-10">
         <div class="text-center">
            <h1 class="text-gray-900 font-bold mb-4" style="font-size: 41px;">Word to PDF</h1>
            <p class="text-gray-600 text-lg mb-6">
               Make DOC and DOCX files easy to read by converting them to PDF.
            </p>
            <div id="controle-buttons" class="flex justify-center items-start">
               <button onclick="document.getElementById('fileUploader').click()"
                  class="bg-red-500 text-white p-3 rounded-lg hover:bg-red-600 transition-colors"
                  style="min-height: 80px; font-weight: bold; font-size: 24px; width: 100%;">
               Select WORD files
               </button>
               <div class="flex flex-col ml-4">
                  <div class="bg-red-500 rounded-full mb-2" style="width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">
                     <img src="assets/dropbox.svg" alt="Dropbox" style="height: 18px; width: 18px;">
                  </div>
                  <div class="bg-red-500 rounded-full" style="width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">
                     <img src="assets/ggdrive.svg" alt="Google Drive" style="height: 18px; width: 18px;">
                  </div>
               </div>
            </div>
            <div id="files-table">
              <table id="files-table" class="mt-8 w-full">
                <thead>
                    <tr>
                      <th>File Name</th>
                      <th>Size</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="fileList">
                </tbody>
              </table>
              <div class="flex justify-between mt-4">
                <button onclick="document.getElementById('fileUploader').click()"
                    class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">Upload More Files</button>
                <button onclick="convertFiles()"
                    class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">Convert</button>
              </div>
            </div>
         </div>
         <input type="file" id="fileUploader" name="fileUploader" class="hidden" accept=".doc,.docx" onchange="uploadFile()">
      </div>
      <footer class="w-full bg-[#f5f5fa] text-gray-900 py-4 text-center mt-auto">
         <ul class="flex justify-center space-x-4">
            <li><a href="/privacy">Privacy</a></li>
            <li><a href="/terms-of-use">Terms of Use</a></li>
            <li><a href="/contact-us">Contact Us</a></li>
         </ul>
      </footer>
      <script>
        let uploadedFiles = [];

        function setControlsVisibility(visible) {
          const controleButtons = document.getElementById('controle-buttons');
          const filesTable = document.getElementById('files-table');

          if(visible) {
            controleButtons.style.display = 'flex';
            filesTable.style.display = 'none';
          } else {
            controleButtons.style.display = 'none';
            filesTable.style.display = 'block';
          }
        }

         async function uploadFile() {
            const fileInput = document.getElementById('fileUploader');
            const file = fileInput.files[0];
            if (!file) {
               return;
            }

            const formData = new FormData();
            formData.append('file', file);
            console.log(file)

            try {
               const response = await fetch('/upload', {
                  method: 'PUT',
                  body: formData
               });

               if (response.ok) {
                  const result = await response.json();
                  console.log(result);
                  const fileData = {
                    fieldname: result.fieldname,
                    originalname: result.originalname,
                    encoding: result.encoding,
                    mimetype: result.mimetype,
                    destination: result.destination,
                    filename: result.fileName,
                    path: result.path,
                    size: result.size,
                  };

                  uploadedFiles.push(fileData);
                  addFileToTable(result.fileName, result.size, 'Uploaded', result.url);
               } else {
                  console.error('Failed to upload file:', response.statusText);
               }
            } catch (error) {
               console.error('Error during the file upload:', error);
            }

            // Clear the input value to allow re-uploading the same file
            fileInput.value = '';
         }

        function addFileToTable(fileName, size, url) {
          const tableBody = document.getElementById('fileList');
          const newRow = document.createElement('tr');

          const nameCell = document.createElement('td');
          nameCell.textContent = fileName;
          newRow.appendChild(nameCell);
          newRow.setAttribute('data-filename', fileName);

          const sizeCell = document.createElement('td');
          sizeCell.textContent = size + ' bytes';  
          newRow.appendChild(sizeCell);

          const statusCell = document.createElement('td');
          statusCell.textContent = 'Uploaded';
          newRow.appendChild(statusCell);

          const actionsCell = document.createElement('td');
          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'X';
          deleteButton.classList.add('text-red-500', 'hover:underline');
          deleteButton.onclick = function() {
            const fileIndex = uploadedFiles.findIndex(uploadedFile => uploadedFile.filename === fileName);
            if (fileIndex !== -1) {
              uploadedFiles.splice(fileIndex, 1);
              tableBody.removeChild(newRow);

              if (tableBody.childElementCount === 0) {
                setControlsVisibility(true); 
              }
            }
          };
          actionsCell.appendChild(deleteButton);
          newRow.appendChild(actionsCell);

          tableBody.appendChild(newRow);

          setControlsVisibility(false);
        }

        async function convertFiles() {
  const tableRows = document.querySelectorAll('#fileList tr');

  for (const row of tableRows) {
    const fileName = row.getAttribute('data-filename');
    const fileUrl = `https://c320a6f0c79e03c4d58d689aead26318.r2.cloudflarestorage.com/world-to-pdf/${fileName}`;

    const formData = new FormData();
    formData.append('fileName', fileName);

    try {
      const response = await fetch('/convertToPdf', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        console.log('File conversion successful');
        row.cells[2].textContent = 'Converted';
        const downloadButton = document.createElement('button');
        downloadButton.textContent = 'Download';
        downloadButton.classList.add('bg-red-500', 'text-white', 'px-4', 'py-2', 'rounded-md', 'hover:bg-red-600');
        downloadButton.onclick = function() {
          downloadPdf(fileUrl);
        };
        row.cells[3].textContent = ''; 
        row.cells[3].appendChild(downloadButton);
      } else {
        console.error('Failed to convert file:', response.statusText);
      }
    } catch (error) {
      console.error('Error converting file:', error);
    }
  }
}

setControlsVisibility(true);

      </script>
   </body>
</html>
